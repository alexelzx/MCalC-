<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McalC+ | Simulation de Moyenne</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass-bg: rgba(15, 23, 42, 0.90);
            --glass-border: rgba(255, 255, 255, 0.15);
            --accent: #3b82f6;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #f8fafc;
        }

        body {
            margin: 0;
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: url('https://iut.univ-tlse3.fr/medias/photo/photo-campus-iut-toulouse_1731415713047-jpg') no-repeat center center fixed;
            background-size: cover;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(15px); z-index: -1;
        }

        .card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            width: 100%; max-width: 1000px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            position: relative;
            display: flex; flex-direction: column; align-items: center;
        }

        .view-section { width: 100%; display: none; animation: fadeIn 0.4s ease; }
        .view-active { display: flex; flex-direction: column; }

        .top-nav { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .nav-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: #94a3b8; padding: 8px 16px; border-radius: 20px; font-size: 0.75rem; cursor: pointer; transition: 0.2s; }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: white; }

        .logos-wrapper { background: white; padding: 12px 30px; border-radius: 16px; display: inline-flex; align-items: center; gap: 20px; margin-bottom: 25px; }
        .logo-img { height: 40px; width: auto; }
        .logo-separator { width: 1px; height: 30px; background: #cbd5e1; }
        h1 { font-weight: 300; font-size: 1.8rem; margin: 0; text-align: center; color: white; }
        .subtitle { color: #94a3b8; font-size: 0.9rem; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 2px; text-align: center; }

        .identity-input {
            width: 100%; max-width: 500px; background: rgba(0,0,0,0.3); border: 2px solid var(--glass-border);
            padding: 20px; border-radius: 15px; color: white; font-size: 1.4rem; text-align: center;
            margin: 20px auto; display: block; font-family: inherit;
        }

        .module-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px; max-height: 45vh; overflow-y: auto; padding: 10px; margin-bottom: 30px;
            background: rgba(0,0,0,0.2); border-radius: 15px;
        }

        .input-row { display: flex; align-items: center; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 10px; padding: 10px 15px; }
        .input-row.rnd-mode { opacity: 0.4; border-style: dashed; }
        .info { flex-grow: 1; }
        .code { font-size: 0.7rem; color: var(--accent); font-weight: 700; display: block; }
        .name { font-size: 0.85rem; font-weight: 500; }
        .coef { font-size: 0.7rem; color: #94a3b8; background: rgba(255,255,255,0.1); padding: 2px 5px; border-radius: 4px; margin-left: 5px; }

        .controls { display: flex; align-items: center; gap: 10px; }
        input[type="number"] { width: 50px; background: transparent; border: none; border-bottom: 2px solid rgba(255,255,255,0.2); color: white; font-size: 1.1rem; text-align: center; outline: none; }

        .result-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; width: 100%; }
        .result-card { background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 20px; padding: 25px; }
        .big-score { font-size: 4.5rem; font-weight: 800; line-height: 1; margin: 10px 0; }
        .decision-badge { display: inline-block; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; color: #000; }
        .analysis-list { list-style: none; padding: 0; font-size: 0.85rem; color: #cbd5e1; }
        .analysis-list li::before { content: "•"; color: var(--accent); margin-right: 8px; }
        .chart-wrapper { height: 280px; width: 100%; }

        .btn { padding: 18px; border-radius: 12px; border: none; font-weight: 600; text-transform: uppercase; cursor: pointer; transition: 0.3s; text-align: center; }
        .btn-primary { background: var(--accent); color: white; width: 100%; }
        .btn-download { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; width: 100%; margin-bottom: 10px; }
        .btn-secondary { background: transparent; border: 1px solid var(--glass-border); color: #94a3b8; padding: 10px 25px; margin: 0 auto; }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; justify-content: center; align-items: center; padding: 20px; }
        .modal-card { background: #1e293b; padding: 40px; border-radius: 24px; border: 1px solid var(--glass-border); max-width: 600px; position: relative; color: #cbd5e1; line-height: 1.5; overflow-y: auto; max-height: 90vh; }
        
        .math-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 15px 0; font-size: 1.1rem; color: white; }
        .fraction { display: inline-flex; flex-direction: column; align-items: center; vertical-align: middle; margin: 0 5px; }
        .numerator { border-bottom: 1px solid white; padding: 0 5px; }
        .denominator { padding: 0 5px; }

        #pdfWrapper { position: absolute; left: -9999px; top: 0; width: 794px; }
        #pdfTemplate { background: white; color: #0f172a; padding: 40px; box-sizing: border-box; width: 794px; }
        .pdf-header { display: flex; justify-content: space-between; border-bottom: 3px solid #0f172a; padding-bottom: 15px; margin-bottom: 20px; }
        .pdf-student-box { background: #f1f5f9; border-left: 5px solid #0f172a; padding: 15px; margin-bottom: 20px; }
        .pdf-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-bottom: 20px;}
        .pdf-th { background: #e2e8f0; padding: 8px; text-align: left; border-bottom: 2px solid #64748b; }
        .pdf-td { padding: 6px 8px; border-bottom: 1px solid #cbd5e1; }
        .pdf-summary-container { display: flex; gap: 20px; page-break-inside: avoid; margin-top: 10px;}
        .pdf-analysis-box { flex: 1; border: 1px solid #cbd5e1; padding: 15px; border-radius: 8px; font-size: 0.75rem; }
        .pdf-score-box { flex: 0 0 200px; background: #0f172a; color: white; padding: 25px; border-radius: 12px; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="overlay"></div>

<div class="card">
    <div class="top-nav">
        <button class="nav-btn" onclick="openModal('helpModal')">Aide</button>
        <button class="nav-btn" onclick="openModal('creditsModal')">Crédits</button>
    </div>

    <div class="logos-wrapper">
        <img src="https://www.univ-tlse3.fr/medias/photo/logo-ut-site_1747041194008-png" alt="UT3" class="logo-img">
        <div class="logo-separator"></div>
        <img src="https://iut.univ-tlse3.fr/uas/iut/LOGO/Logo_IUT_ACT_couleurs.png" alt="IUT" class="logo-img">
    </div>

    <h1>SIMULATEUR DE RÉSULTATS</h1>
    <div class="subtitle">BUT Info-Com — Semestre 1 — Document Non Officiel</div>

    <div id="viewStep1" class="view-section view-active">
        <input type="text" id="studentName" class="identity-input" placeholder="NOM ET PRÉNOM" value="Tappez...">
        <button class="btn btn-primary" onclick="showStep(2)">COMMENCER LA SAISIE</button>
    </div>

    <div id="viewStep2" class="view-section">
        <div class="module-grid" id="gridContainer"></div>
        <div style="display:flex; gap:15px; width:100%;">
            <button class="btn btn-secondary" onclick="showStep(1)">RETOUR</button>
            <button class="btn btn-primary" onclick="calculateAndShow()">VOIR LES RÉSULTATS</button>
        </div>
    </div>

    <div id="viewStep3" class="view-section">
        <div class="result-container">
            <div class="result-card">
                <div style="text-align:center;">
                    <div style="text-transform:uppercase; color:#94a3b8; font-size:0.8rem;">Moyenne Générale</div>
                    <div id="screenScore" class="big-score">--</div>
                    <div id="screenDecision" class="decision-badge">--</div>
                </div>
                <hr style="border:0; border-top:1px solid var(--glass-border); margin:15px 0;">
                <div class="analysis-box">
                    <h4 style="color:var(--accent); margin:0;">Points Forts</h4><ul id="screenStrengths" class="analysis-list"></ul>
                    <h4 style="color:var(--warning); margin:10px 0 0 0;">Zones de vigilance</h4><ul id="screenWeaknesses" class="analysis-list"></ul>
                </div>
            </div>
            <div class="result-card">
                <div class="chart-wrapper"><canvas id="radarChart"></canvas></div>
            </div>
        </div>
        <button class="btn btn-download" onclick="generatePDF()">TÉLÉCHARGER LE RAPPORT COMPLET (PDF)</button>
        <button class="btn btn-secondary" onclick="showStep(2)">MODIFIER LES NOTES</button>
    </div>
</div>

<div class="modal-overlay" id="helpModal">
    <div class="modal-card">
        <span onclick="closeModal('helpModal')" style="position:absolute; top:15px; right:20px; cursor:pointer; font-size:1.5rem;">&times;</span>
        <h2 style="color:white; margin-top:0;">Aide & Guide d'utilisation</h2>
        <div style="font-size: 0.9rem;">
            <p><strong>• Lecture des codes :</strong> Les codes simplifiés correspondent aux codes officiels (ex: <code>R1.04</code> = BITM1R04). Si le code commence par la lettre <strong>S</strong> (ex: <code>S1.01</code>), il s'agit d'une <strong>SAÉ</strong>.</p>
            
            <p><strong>• Exhaustivité de la liste :</strong> Tous les enseignements du semestre sont listés ici par défaut. Cela ne signifie pas que vous avez forcément une note pour chaque module (cela dépend de votre parcours spécifique).</p>
            
            <p><strong>• Option RND (Résultat Non Disponible) :</strong> Cochez cette case dans les situations suivantes :
                <ul style="margin: 5px 0 10px 20px;">
                    <li>Vous n'avez pas encore reçu votre note.</li>
                    <li>La matière n'existe pas ou n'est pas notée dans votre cursus.</li>
                </ul>
                Les lignes en mode RND ne sont pas comptabilisées dans le calcul final.
            </p>

            <hr style="border:0; border-top:1px solid #334155; margin:15px 0;">
            
            <p><strong>• Calcul de la moyenne :</strong> Le simulateur utilise la moyenne pondérée officielle :</p>
            <div class="math-box">
                Moyenne = 
                <div class="fraction">
                    <span class="numerator">Σ (Note × Coefficient)</span>
                    <span class="denominator">Σ Coefficients</span>
                </div>
            </div>
            <p style="font-size: 0.8rem; color: #94a3b8;">Pour le faire vous-même : multipliez chaque note par son coefficient, additionnez tous ces résultats, puis divisez par le total des coefficients des matières notées.</p>
        </div>
    </div>
</div>

<div class="modal-overlay" id="creditsModal">
    <div class="modal-card">
        <span onclick="closeModal('creditsModal')" style="position:absolute; top:15px; right:20px; cursor:pointer; font-size:1.5rem;">&times;</span>
        <h3 style="color:white; margin:0;">Alexios ELIZALDE XIROKOSTA</h3>
        <p style="color:var(--accent);">IUT Toulouse III - Paul Sabatier</p>
        <p style="font-size:0.85rem;">Etudiant| INO1 C2 | Représentant au Conseil de l'IUT | 2026-2028</p>
        <hr style="border:0; border-top:1px solid #334155; margin:15px 0;">
        <div style="text-align:center; font-size:0.8rem;">alexios.elizalde-xirokosta@etu.iut-tlse3.fr</div>
    </div>
</div>

<div id="pdfWrapper">
    <div id="pdfTemplate">
        <div class="pdf-header">
            <div><div style="font-size:1.4rem; font-weight:bold;">SIMULATION DE RÉSULTATS</div><div style="color:#64748b;">BUT Information-Communication — S1</div></div>
            <div style="text-align:right;"><div style="font-weight:bold;">IUT Paul Sabatier</div><div style="color:#64748b;">Année 2025/2026</div></div>
        </div>
        <div class="pdf-student-box">
            <div style="font-size:0.6rem; font-weight:bold; color:#64748b;">CANDIDAT(E)</div>
            <div style="font-size:1.2rem; font-weight:bold;" id="pdfName"></div>
            <div style="font-size:0.65rem; color:#dc2626; font-weight:bold; margin-top:4px;">DOCUMENT DE SIMULATION — VALEUR NON-OFFICIELLE</div>
        </div>

        <table class="pdf-table">
            <thead><tr><th class="pdf-th">Code</th><th class="pdf-th">Module</th><th class="pdf-th" style="text-align:center;">Coef.</th><th class="pdf-th" style="text-align:right;">Note</th></tr></thead>
            <tbody id="pdfTableBody"></tbody>
        </table>

        <div class="pdf-summary-container">
            <div class="pdf-analysis-box">
                <div style="font-weight:bold; margin-bottom:5px; text-transform:uppercase;">Analyse :</div>
                <div style="color:#16a34a; font-weight:bold;">Points Forts :</div><div id="pdfStrengths" style="margin-bottom:10px;">-</div>
                <div style="color:#ca8a04; font-weight:bold;">Zones de vigilance :</div><div id="pdfWeaknesses">-</div>
            </div>
            <div class="pdf-score-box">
                <div style="font-size:0.75rem; opacity:0.8;">Moyenne Générale</div>
                <div id="pdfAvg" style="font-size:3.5rem; font-weight:bold;">--</div>
                <div id="pdfDecision" style="background:rgba(255,255,255,0.15); padding:8px; border-radius:10px; margin-top:15px; font-weight:bold; font-size:0.8rem;">--</div>
            </div>
        </div>
    </div>
</div>

<script>
    const modules = [
        { id: 'R1.01', name: 'Psychosociologie (SHS)', coef: 9, cat: 'SHS' }, { id: 'R1.02', name: 'Histoire des Médias', coef: 5, cat: 'SHS' },
        { id: 'R1.03', name: 'SIC (Théories)', coef: 9, cat: 'SIC' }, { id: 'R1.04', name: 'Étude des Organisations', coef: 7, cat: 'SIC' },
        { id: 'R1.05', name: 'Recherche Info. & Veille', coef: 3, cat: 'Tech' }, { id: 'S1.01', name: 'SAÉ : Synthèse Doc.', coef: 28, cat: 'SAÉ' },
        { id: 'R1.06', name: 'Anglais', coef: 7, cat: 'Lang' }, { id: 'R1.07', name: 'Langue Vivante 2', coef: 7, cat: 'Lang' },
        { id: 'R1.08', name: 'Expression Écrite/Orale', coef: 7, cat: 'Lang' }, { id: 'R1.09', name: 'PAO (Graphisme)', coef: 7, cat: 'Tech' },
        { id: 'R1.10', name: 'Info. Bureautique', coef: 7, cat: 'Tech' }, { id: 'R1.11', name: 'Info. Web (Code)', coef: 7, cat: 'Tech' },
        { id: 'R1.12', name: 'PPP', coef: 4, cat: 'Pro' }, { id: 'S1.02', name: 'SAÉ : Éloquence', coef: 18, cat: 'SAÉ' },
        { id: 'R1.I.13', name: 'Culture & Éco. Numérique', coef: 18, cat: 'SIC' }, { id: 'R1.I.15', name: 'Métadonnées', coef: 9, cat: 'Tech' },
        { id: 'R1.I.20', name: 'Bases de la Com.', coef: 9, cat: 'SIC' }, { id: 'S1.I.03', name: 'SAÉ : Étude de SI', coef: 34, cat: 'SAÉ' },
        { id: 'R1.I.16', name: 'Info. Pro (IA)', coef: 6, cat: 'Tech' }, { id: 'R1.I.17', name: 'Gestion de Projet', coef: 7, cat: 'Pro' },
        { id: 'R1.I.18', name: 'Veille (Métho)', coef: 7, cat: 'Tech' }, { id: 'R1.I.14', name: 'Rech. Info. Spé.', coef: 5, cat: 'Tech' },
        { id: 'R1.I.19', name: 'PAO Pro', coef: 7, cat: 'Tech' }, { id: 'S1.I.04', name: 'SAÉ : Panorama Presse', coef: 24, cat: 'SAÉ' }
    ];

    let myChart = null;

    const grid = document.getElementById('gridContainer');
    modules.forEach((m, i) => {
        grid.innerHTML += `<div class="input-row" id="row-${i}"><div class="info"><span class="code">${m.id}</span><span class="name">${m.name}</span><span class="coef">x${m.coef}</span></div>
        <div class="controls"><label style="font-size:0.6rem; color:#94a3b8;"><input type="checkbox" id="rnd-${i}" onchange="toggleRND(${i})"> RND</label>
        <input type="number" id="grade-${i}" placeholder="-" min="0" max="20" step="0.1"></div></div>`;
    });

    function showStep(s) { document.querySelectorAll('.view-section').forEach(v => v.classList.remove('view-active')); document.getElementById('viewStep'+s).classList.add('view-active'); }
    function toggleRND(i) { const input = document.getElementById(`grade-${i}`); const row = document.getElementById(`row-${i}`); const isChecked = document.getElementById(`rnd-${i}`).checked; input.disabled = isChecked; if(isChecked) { row.classList.add('rnd-mode'); input.value=''; } else { row.classList.remove('rnd-mode'); } }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function calculateAndShow() {
        let totalPts = 0, totalCoef = 0, hasData = false;
        let cats = { 'SAÉ':{p:0, c:0}, 'Tech':{p:0, c:0}, 'SIC':{p:0, c:0}, 'Lang':{p:0, c:0}, 'SHS':{p:0, c:0}, 'Pro':{p:0, c:0} };
        let strengths = [], weaknesses = [], pdfRows = "";

        modules.forEach((m, i) => {
            const isRND = document.getElementById(`rnd-${i}`).checked;
            const valStr = document.getElementById(`grade-${i}`).value;
            if(!isRND && valStr !== "") {
                const val = parseFloat(valStr); totalPts += val * m.coef; totalCoef += m.coef; cats[m.cat].p += val * m.coef; cats[m.cat].c += m.coef; hasData = true;
                if(val >= 14) strengths.push(`${m.name} (${val})`); if(val < 10) weaknesses.push(`${m.name} (${val})`);
                pdfRows += `<tr><td class="pdf-td"><b>${m.id}</b></td><td class="pdf-td">${m.name}</td><td class="pdf-td" style="text-align:center;">${m.coef}</td><td class="pdf-td" style="text-align:right;"><b>${val}</b></td></tr>`;
            } else if (isRND) {
                pdfRows += `<tr style="color:#94a3b8; font-style:italic;"><td class="pdf-td">${m.id}</td><td class="pdf-td">${m.name}</td><td class="pdf-td" style="text-align:center;">-</td><td class="pdf-td" style="text-align:right;">RND</td></tr>`;
            }
        });

        if(!hasData) return alert("Saisissez au moins une note.");
        const avg = totalPts / totalCoef;
        const statusColor = avg >= 10 ? "#22c55e" : "#ef4444";
        
        document.getElementById('screenScore').innerText = avg.toFixed(2);
        document.getElementById('screenScore').style.color = statusColor;
        document.getElementById('screenDecision').innerText = avg >= 10 ? "ADMIS" : "AJOURNÉ";
        document.getElementById('screenDecision').style.backgroundColor = statusColor;
        document.getElementById('screenStrengths').innerHTML = strengths.map(s => `<li>${s}</li>`).join('') || "<li>Aucun module > 14</li>";
        document.getElementById('screenWeaknesses').innerHTML = weaknesses.map(w => `<li>${w}</li>`).join('') || "<li>Aucun module < 10</li>";

        const ctx = document.getElementById('radarChart');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'radar',
            data: { labels: Object.keys(cats), datasets: [{ data: Object.keys(cats).map(k => cats[k].c > 0 ? (cats[k].p / cats[k].c).toFixed(1) : 0), backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6', pointBackgroundColor: '#fff' }] },
            options: { scales: { r: { grid: {color:'rgba(255,255,255,0.1)'}, pointLabels:{color:'#94a3b8'}, suggestedMin:0, suggestedMax:20 } }, plugins: { legend: {display:false} } }
        });

        document.getElementById('pdfName').innerText = document.getElementById('studentName').value;
        document.getElementById('pdfTableBody').innerHTML = pdfRows;
        document.getElementById('pdfAvg').innerText = avg.toFixed(2);
        document.getElementById('pdfDecision').innerText = avg >= 10 ? "ADMIS / VALIDÉ" : "AJOURNÉ / NON VALIDÉ";
        document.getElementById('pdfStrengths').innerText = strengths.join(', ') || "Néant";
        document.getElementById('pdfWeaknesses').innerText = weaknesses.join(', ') || "Néant";

        showStep(3);
    }

    function generatePDF() {
        const element = document.getElementById('pdfTemplate');
        const opt = {
            margin: 0,
            filename: 'Simulation_Resultats.pdf',
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 2, useCORS: true, scrollY: 0, y: 0 },
            jsPDF: { unit: 'px', format: [794, 1123], orientation: 'portrait' },
            pagebreak: { mode: ['auto', 'avoid-all'], before: '.pdf-summary-container' }
        };
        window.scrollTo(0,0);
        html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>